{% load i18n static poll_votings %}

{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}
<form action="{% url 'molo.polls:vote' question.id %}" method="post">
  {% csrf_token %}
  <div class="radios">
    {% if not request.user.is_authenticated%}
      {% for choice in question.choices %}
        <div>
          {% if question.allow_multiple_choice%}
            <input type="checkbox" name="choice" id="choice{{ forloop.counter }}" value="{{ choice.id }}" />
            <label for="choice{{ forloop.counter }}">{{ choice.title }}</label>
          {% else %}
            <input type="radio" name="choice" id="choice{{ forloop.counter }}" value="{{ choice.id }}" />
            <label for="choice{{ forloop.counter }}">{{ choice.title }}</label>
          {% endif %}
        </div>
      {% endfor %}
    {% elif request.user.is_authenticated %}
      {% can_vote question as user_can_vote %}
          {% if user_can_vote %}
            {% for choice in question.choices %}
              <div>
                {% if question.allow_multiple_choice%}
                  <input type="checkbox" name="choice" id="choice{{ forloop.counter }}" value="{{ choice.id }}" />
                  <label for="choice{{ forloop.counter }}">{{ choice.title }}</label>
                {% else %}
                  <input type="radio" name="choice" id="choice{{ forloop.counter }}" value="{{ choice.id }}" />
                  <label for="choice{{ forloop.counter }}">{{ choice.title }}</label>
                {% endif %}
              </div>
            {% endfor %}
            {% elif not question.show_results %}
              {% user_choice question as user_choice %}
              <h5 style="color: #666666">{% trans "You voted: " %}{{user_choice}}</h5>
          {% endif %}
  {% endif %}
  </div>

  {% if request.user.is_authenticated %}
    {% can_vote question as user_can_vote %}
    {% if user_can_vote %}
      <input type="submit"  class="l-indent" value="{% trans "Vote" %}" />
    {% elif question.show_results %}
      <a href="{% url 'molo.polls:results' question.id %}" class="button">{% trans "Show Results" %}</a>
    {% endif %}
  {% else %}
    <a href="{% url 'molo.profiles:auth_login' %}?next={{request.path}}" class="button">{% trans "Log in to vote" %}</a>
  {% endif %}
</form>
