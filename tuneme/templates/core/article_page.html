{% extends "core/_article_page.html" %}
{% load wagtailcore_tags wagtailimages_tags comments mptt_tags molo_commenting_tags static poll_votings i18n %}

{% block content %}
    <ul class="sub-navigation-list l-indent">
        <li class="sub-navigation-list__item">
            <a href="{{request.site.root_page.url}}">{% trans "Home" %}</a>
        </li>
        <li class="sub-navigation-list__item">
            <a href="">{{self.get_parent_section.title}}</a>
        </li>
        <li class="sub-navigation-list__item">
            <a href="">{{self.title}}</a>
        </li>
    </ul>
    <!--<div class="title {# {{self.get_parent_section.get_effective_extra_style_hints}} #}
    {# {% if self.image %}feature-image{% endif %}  #}">
      <div class="icon">
        {# {% if self.get_parent_section.get_effective_image %} #}
          {# {% image self.get_parent_section.get_effective_image width-98 as tmp_photo %} #}
          <img src="{# {{ tmp_photo.url }} #}" alt="{# {{ self.get_effective_image.title }} #}"/>
        {# {% endif %} #}
      </div>

      <h6 class="f-medium">
          <a href="{# {% pageurl self.get_parent_section %}">{{self.get_parent_section.title}} #}</a>
      </h6>
    </div>-->
    <div class="article article{{self.get_parent_section.get_effective_extra_style_hints}} l-indent">
      {% if messages %}
      <ul class="messages">
          {% for message in messages %}
          <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
          {% endfor %}
      </ul>
      {% endif %}

      {% if self.image %}
      {% image self.image width-98 as tmp_photo_small %}
      {% image self.image width-620 as tmp_photo_large %}
        <img src="{{ tmp_photo_small.url }}" srcset="{{ tmp_photo_large.url }}" alt="{{ self.image.title }}"/>
      {% endif %}
      <h1 class="article-heading f-large">{{self.title}}</h1>
      <h3 class="f-bigger">{{self.subtitle}}</h3>
      <div class="article-copy">
        {% for block in self.body %}
          {% if block.block_type == 'heading' %}
            <span class="article-heading">{{ block.value }}</span>
          {% else %}
          {% if block.block_type == 'list' %}
             <span class="page-includes">{{ block }}</span>
          {% else %}
          {% if block.block_type == 'image' %}
            {% image block.value width-98 as tmp_photo_small %}
            {% image block.value width-620 as tmp_photo_large %}
            <img src="{{ tmp_photo_small.url }}" srcset="{{ tmp_photo_large.url }}" alt="{{ self.image.title }}"/>
          {% else %}
          {% if block.block_type == 'numbered_list' %}
            <ol class="numbered-list">
            {% for item in block.value %}
              <li class="numbered-list__item">{{item}}</li>
            {% endfor %}
            </ol>
          {% endif %}
          {% endif %}
          {% endif %}
          {% endif %}
        {% endfor %}
      </div>
    </div>

    {% with section=self.get_parent_section %}
        <h2 class="heading heading{{ section.get_effective_extra_style_hints }}">
            {% trans "Must Read" %}
        </h2>
        <ul class="article__links article__links{{ section.get_effective_extra_style_hints}}">
            {% for block in self.body %}
                {% if block.block_type == 'page' %}
                    <li class="article__link--item l-indent l-indent--small">
                        <a href="{% pageurl block.value %}">{{ block.value }}</a>
                    </li>
                {% endif %}
            {% endfor %}
        </ul>
    {% endwith %}

{% has_questions self as questions %}
{% if questions %}
<div class="questions">
  <div class="title">
    <div class="icon"><a href=""><img src="{% static 'img/polls.png' %}" alt="Have Your Say"></a></div>
      <h6><a href="">{% trans "Have Your Say" %}</a></h6>
  </div>
{% poll_page_in_section page=self %}
</div>
{% endif %}

{% if self.is_commenting_enabled %}
<div class="post-comments post-comments{{self.get_parent_section.get_effective_extra_style_hints}} l-indent">
    {% if self.allow_commenting %}
      {% get_comment_count for self as comment_count %}
      {% if comment_count > 0 %}
          <div class="posted-comments-heading">
                <div class="post-comment-title">
                    <h5>{% trans "Comment" %}</h5>
                </div>
                <div class="posted-comments-count">
                    <a href="#">{{comment_count}}
                        <span>{% trans "comment" %}{{comment_count|pluralize}}</span>
                    </a>
                </div>
          </div>
      {% endif %}
      <div class="post-comment">
          {% if request.user.is_authenticated %}
            {% render_comment_form for self %}
          {% else %}
                <a href="{% url 'molo.profiles:auth_login' %}?next={{request.path}}" class="submit-button inverted">{% trans "Log in to comment" %}</a>
          {% endif %}
            {% else %}
              <p>{% trans "Commenting on this article is currently disabled" %}</p>
            {% endif %}
     </div>

</div>
<div id="comments-list" class="comments-list">
  {% get_comment_count for self as comment_count %}
    {% get_molo_comments for self as comment_list %}
      {% for node in comment_list %}
          {% recursetree node %}
            {% include "comments/comment.html" %}
            {{ children }}
          {% endrecursetree %}
      {% endfor %}
  {% if comment_count > 5 %}
    <div class="pagination">
      <a href="{% url 'more-comments' self.pk %}">{% trans "view more comments" %}</a>
    </div>
  {% endif %}
</div>
{% endif %}

{% endblock %}
