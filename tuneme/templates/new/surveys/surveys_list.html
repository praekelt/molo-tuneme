{% load wagtailcore_tags i18n %}

{% block content %}
	{% for survey in surveys %}
	{% with survey=survey.molo_survey_page form=survey.form %}
<div class="{% if not survey.display_survey_directly %}surveys{% else %}polls{% endif %}">
	<h1 class="{% if not survey.display_survey_directly %}surveys{% else %}polls{% endif %}__title">{{ survey.title }}</h1>
  <h4 class="{% if not survey.display_survey_directly %}surveys{% else %}polls{% endif %}__intro">{{ survey.intro }}</h4>
  {% if not survey.display_survey_directly %}
  	<div class="call-to-action call-to-action--{% if not survey.display_survey_directly %}surveys{% else %}polls{% endif %}">
  		<a href="{% pageurl survey %}" class="call-to-action__nav-item call-to-action__nav-item--{% if not survey.display_survey_directly %}surveys{% else %}polls{% endif %}">
        {% trans 'Take The Survey' %}</a>
  	</div>
  {% else %}
		{% if user.is_authenticated and user.is_active or request.is_preview or survey.allow_anonymous_submissions %}
		{% if form %}
		  <form class="{% if not survey.display_survey_directly %}surveys{% else %}polls{% endif %}__form" action="{% pageurl survey %}{% if survey.multi_step %}?p={{ fields_step.number|add:"1" }}{% endif %}" method="post">
			{% csrf_token %}
			  {% for field in form %}
				<fieldset>
				  <label for="{{ field.id_for_label }}">{{ field.label }}</label>
				  <span class="{% if not survey.display_survey_directly %}surveys{% else %}polls{% endif %}__helptext">{{ field.help_text }}</span>
				  {{ field }}
          {% if field.errors %}
            <ul class="error error--{% if not survey.display_survey_directly %}surveys{% else %}polls{% endif %}">
            {% for error in field.errors %}
              <li>{{ error }}</li>
            {% endfor %}
            </ul>
          {% endif %}
        </fieldset>
        {% endfor %}
		    <input type="submit" value="{% if is_intermediate_step %}{% trans 'Next Question' %}{% else %}{% trans 'Submit' %}{% endif %}" />
		    </form>
		    {% else %}
					<p class="error error--{% if not survey.display_survey_directly %}surveys{% else %}polls{% endif %}">{% trans 'You have already completed this survey.' %}</p>
				{% endif %}
			{% else %}
		    <div class="call-to-action call-to-action--{% if not survey.display_survey_directly %}surveys{% else %}polls{% endif %}">
		      <a href="{% url 'molo.profiles:auth_login' %}?next={{request.path}}" class="call-to-action__nav-item call-to-action__nav-item--{% if not survey.display_survey_directly %}surveys{% else %}polls{% endif %}">
            {% trans 'Please log in to take this' %}
            {% if not survey.display_survey_directly %}{% trans 'surveys' %}{% else %}{% trans 'poll' %}{% endif %}
          </a>
		    </div>
		{% endif %}
{% endif %}
</div>
{% endwith %}
{% endfor %}
{% endblock %}
